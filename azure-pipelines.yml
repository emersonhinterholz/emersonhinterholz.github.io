# HTML
# Archive your static HTML project and save it with the build record.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:

- task: UseNode@1
  inputs:
    version: '12.x'
- task: Bash@3
  displayName: Updating GTAG, "updated" meta tag and Instrumentation Key
  inputs:
    targetType: 'inline'
    script: |
      npm i replace-in-file
      cd $(build.sourcesDirectory)/html
      node $(build.sourcesDirectory)/pipeline/replace-gtag.js
      node $(build.sourcesDirectory)/pipeline/replace-updated.js
      node $(build.sourcesDirectory)/pipeline/replace-instrumentation-key.js
      node $(build.sourcesDirectory)/pipeline/replace-year.js
- task: Bash@3
  displayName: Minifying HTML and CSS
  inputs:
    targetType: 'inline'
    script: |
      cd $(build.sourcesDirectory)/pipeline/gulp
      npm i
      gulp
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(build.sourcesDirectory)/pipeline/gulp/dist'
    includeRootFolder: false
- task: PublishBuildArtifacts@1
